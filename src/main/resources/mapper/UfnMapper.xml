<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTDMapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="spring.mvc.mapper.UFnMapperInter">

	<!-- 정보 변경 -->
	<update id="updateUser" parameterType="udto">
		update USER set u_hp=#{u_hp}, u_birth=#{u_birth}, u_email=#{u_email},
		u_addr=#{u_addr} where u_id=#{u_id}
	</update>
	
   <update id="updatePw" parameterType="Map">
      update USER set u_pw=#{u_pw}
      where u_id=#{u_id}
   </update>

   <update id="updatePhoto" parameterType="Map">
      update USER set
      u_photo=#{u_photo} where u_id=#{u_id}
   </update>

   <select id="getResume" resultType="rdto" parameterType="String">
      select *
      from RESUME where u_num=#{u_num} and r_presume=1
   </select>
   
 	<!-- 관심 기업 -->
	<!-- 관심 기업 수 -->
   <select id="countLikeEnterprise" resultType="int"
      parameterType="String">
      select count(h_num) from HEART where u_num=#{u_num}
   </select>
   
   <!-- 기업 리스트 -->
   <select id="getEnterPrise" resultType="edto"
      parameterType="string">
      select * from ENTERPRISE where e_num=#{e_num} 
   </select>

	<!-- 관심 기업 데이터 갖고오기 -->
	<select id="getLikeEnterPrise" resultType="hdto" parameterType="string">
		select * from HEART where u_num=#{u_num} 
	</select>

   <!-- 좋아요버튼 누르면 데이터 저장됨 -->
   <insert id="insertLikeEnter" parameterType="hdto">
      insert into HEART
      (u_num, e_num) values (#{u_num},#{e_num})
   </insert>

	<!-- 좋아요버튼 다시 누르면 데이터 삭제됨 -->
	<delete id="deleteLikeEnter" parameterType="String">
		delete from HEART where h_num=#{h_num}
	</delete>
	
	<!-- 좋아요 버튼 눌렀는지 확인하는 sql -->
	<select id="checkLikeEnter" resultType="hdto" parameterType="Map">
		select * from HEART where u_num=#{u_num} and e_num=#{e_num}
	</select>
	
	<!-- 작성한 이력서 목록 가져오기 -->
	<select id="getMyResume" resultType="rdto"
		parameterType="String">
		select * from RESUME where u_num=#{u_num}
	</select>

	<!-- UserId에 해당하는 RESUME 찾기 -->
	<select id="getResumeByUserId" resultType="rdto" parameterType="String">
    	SELECT * FROM RESUME WHERE u_num = (SELECT u_num FROM USER WHERE u_id = #{u_id})
  	</select>

	<!-- 이력서 detailpage -->
	<select id="getResumeOfRNum" resultType="rdto"
		parameterType="String">
		select * from RESUME where r_num=#{r_num}
	</select>

	<!-- 열람 -->
	<insert id="insertViewer" parameterType="vdto">
		insert into
		VIEWER(u_num,p_num) values(#{u_num},#{p_num})
	</insert>

	<!-- u_num 중복체크 -->
	<select id="getSearchUnum" parameterType="Map" resultType="int">
		select count(*) from VIEWER where u_num=${u_num} and p_num=#{p_num}
	</select>

	<!-- 탈퇴 -->
	<delete id="deleteUser" parameterType="String">
		delete from USER where
		u_num=#{u_num}
	</delete>

	<!-- 비공개로 설정 -->
	<update id="updatePrivate" parameterType="int">
		update RESUME set
		r_private=1 where r_num=#{r_num}
	</update>

	<!-- 공개로 설정 -->
	<update id="updatePublic" parameterType="int">
		update RESUME set
		r_private=0 where r_num=#{r_num}
	</update>

	<!-- 대표 설정 -->
	<update id="updateMainOn" parameterType="int">
		update RESUME set r_presume=1 where r_num=#{r_num}
	</update>
	
	<!-- 대표 전체해제 -->
	<update id="updateAllOff">
		update RESUME set r_presume=0
	</update>

	<!-- 대표 해제 -->
	<update id="updateMainOff" parameterType="int">
		update RESUME set
		r_presume=0 where r_num=#{r_num}
	</update>

	<!-- 주소 변경 -->
	<update id="updateUserNoAddr" parameterType="Map">
		update USER set
		u_hp=#{u_hp}, u_birth=#{u_birth}, u_email=#{u_email} where
		u_id=#{u_id}
	</update>

	<!-- 이력서 등록 -->
	<insert id="insertResume" parameterType="rdto">
		insert into RESUME
		values(null, #{u_num}, #{r_title}, #{r_larea},
		#{r_ltask}, #{r_ltype},
		#{r_lperiod}, #{r_lday}, #{r_content}, #{r_presume}, #{r_private},
		now())
	</insert>
	
	<!-- 관심 공고(스크랩) -->
	<!-- 관심 공고 count -->
	<select id="countScrapPosting" resultType="int" parameterType="String">
		select count(s_num) from SCRAP where u_num=#{u_num}
	</select>

	<!-- 공고 리스트 -->
	<select id="getPosting" resultType="sdto" parameterType="string">
		select * from SCRAP where p_num=#{p_num} 
	</select>

	<!-- 관심 공고 데이터 갖고오기 -->
	<select id="getUserScrap" resultType="sdto" parameterType="string">
		select * from SCRAP where u_num=#{u_num}
	</select>

	<!-- 스크랩버튼 누르면 데이터 저장됨 -->
	<insert id="insertScrapPosting" parameterType="sdto">
		insert into SCRAP (u_num, p_num) values (#{u_num},#{p_num})
	</insert>

	<!-- 스크랩버튼 다시 누르면 데이터 삭제됨 -->
	<delete id="deleteScrapPosting" parameterType="String">
		delete from SCRAP where s_num=#{s_num}
	</delete>
	
	<!-- 스크랩 버튼 눌렀는지 확인하는 sql -->
	<select id="checkScrapPosting" resultType="sdto" parameterType="Map">
		select * from SCRAP where u_num=#{u_num} and p_num=#{p_num}
	</select>
	
	
	

</mapper>